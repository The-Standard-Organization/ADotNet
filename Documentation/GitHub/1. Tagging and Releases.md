# 1. Tagging and Releases with GitHub Actions
Tagging and creating releases are essential concepts in version control systems, 
particularly when working with GitHub repositories. In version control, 
tagging refers to assigning a unique identifier to a specific point in the project's history, 
typically to mark significant milestones or releases. On the other hand, creating a release on 
GitHub involves packaging a specific version of your project's source code and associated assets, 
such as binaries or documentation, into a cohesive release package. These two concepts are closely 
related, as tagging provides a convenient way to label specific commits and then utilize those tags 
to create well-defined releases on GitHub. In this section, we will delve into tagging and creating 
releases.

To implement the tagging process described, we can add an extra step named "add_tag" under the "jobs" 
section in our pipeline configuration file. This step will create a tag and a release under specific 
conditions. 

All the conditions that needs to be satisfied for creating a tag and a release are as follows:
- The **"build" job MUST have succeeded**.
- The **pull request IS targeted at the main/master** branch and that the event triggering the pipeline **IS a MERGE pull request**.
  - This is important as we do not want to create a tag and a release for every pull request that is created.
- The pull request **title starts with "RELEASES:"** and the pull request **has a label named "RELEASES"**.
  - Not all pull requests are meant to be releases, so we need to make sure that the pull request is meant to be a release.  We do this by checking that the pull request title and label.
    

Here's an example of how this can be achieved:

The first thing we need to do is to expand the "on" section of our pipeline configuration file to include the "pull_request" event. 
This will allow us to trigger the pipeline when a merge pull request is created. We do this by specifying the types of pull request 
events that we want to trigger the pipeline. (We are interrestes in the "closed", 
but also need to include the "opened", "synchronize", and "reopened" events as well so that we don't prevent the action from running for other scenarios.)

**yaml change required for the `on:` section**
```yaml
on:
  push:
    branches:
    - master
  pull_request:
    types:
    - opened
    - synchronize
    - reopened
    - closed
    branches:
    - master
```

Next we will have a look at the "add_tag" job. This job will be triggered when the "build" job has succeeded and all the conditions described above are met.

```yaml
jobs:
  build:
    # ... your existing build job configuration

  add_tag:
    runs-on: ubuntu-latest
    needs:
      - build
    if: >-
      needs.build.result == 'success' &&
      github.event.pull_request.merged &&
      github.event.pull_request.base.ref == 'master' &&
      startsWith(github.event.pull_request.title, 'RELEASES:') &&
      contains(github.event.pull_request.labels.*.name, 'RELEASES')
    steps:
      - name: Checkout code
        uses: actions/checkout@v3
      - name: Extract Version Number and Release Notes
        id: extract_version
        run: |
          echo "version_number=$(grep -oP '(?<=<Version>)[^<]+' ADotNet/ADotNet.csproj)" >> $GITHUB_ENV
          echo "package_release_notes=$(grep -oP '(?<=<PackageReleaseNotes>)[^<]+' ADotNet/ADotNet.csproj)" >> $GITHUB_ENV
      - name: Print Version Number and Release Notes
        run: |
          echo "Version number - v${{ steps.extract_version.outputs.version_number }}"
          echo "Release Notes - ${{ steps.extract_version.outputs.package_release_notes }}"
      - name: Configure Git
        run: |
          git config user.name "GitHub Action"
          git config user.email "action@github.com"
      - name: Authenticate with GitHub
        uses: actions/checkout@v3
        with:
          token: ${{ secrets.PAT_FOR_TAGGING }}
      - name: Add Release Tag
        run: |
          git tag -a "v${{ steps.extract_version.outputs.version_number }}" -m "Release - v${{ steps.extract_version.outputs.version_number }}"
          git push origin --tags
      - name: Create Release
        uses: actions/create-release@v1
        with:
          tag_name: v${{ steps.extract_version.outputs.version_number }}
          release_name: Release - v${{ steps.extract_version.outputs.version_number }}
          body: >-
            ### Release - v${{ steps.extract_version.outputs.version_number }}

            #### Release Notes

            ${{ steps.extract_version.outputs.package_release_notes }}

```

Let's break down the "add_tag" job into its individual steps:

1. **needs: build**: This indicates that the "add_tag" job depends on the presence of the "build" job and that it will run after that job.
2. **if:** This conditional expression determines whether the job should be executed based on certain conditions:

    - **needs.build.result == 'success'**: Ensures that the "build" job has a successful result.
    
    - **github.event.pull_request.merged**: Checks if the event triggering the pipeline is a merged pull request.
    
    - **github.event.pull_request.base.ref == 'master'**: Verifies that the pull request is targeted at the master branch.
    
    - **startsWith(github.event.pull_request.title, 'RELEASES:')**: Checks if the pull request title starts with "RELEASES:".
    
    - **contains(github.event.pull_request.labels.*.name, 'RELEASES')**: Ensures that the pull request has a label named "RELEASES".

3. **steps**: This section contains a series of steps that will be executed if the conditions in the if statement are met

    - **Checkout code**: Checks out the repository code using the actions/checkout action.

    - **Extract Version Number and Release Notes**: Uses shell commands to extract the version number and package release notes from the ADotNet.csproj file. The extracted values are stored in environment variables using the >> $GITHUB_ENV syntax.

    - **Print Version Number and Release Notes**: Prints the extracted version number and release notes to the console for verification.

    - **Configure Git**: Sets the Git configuration with a user name and email.

    - **Authenticate with GitHub**: Authenticates the action with GitHub using the provided token.

    - **Add Release Tag**: Creates a Git tag with the extracted version number, annotating it with a message indicating the release version. The tag is then pushed to the remote repository.

    - **Create Release**: Uses the actions/create-release action to create a release on GitHub. It sets the tag name, release name, and body of the release. The version number and release notes are populated dynamically using the outputs from the "Extract Version Number" step.


Overall, the "add_tag" job automates the process of creating a tag and release on GitHub when specific conditions related to successful builds, merged pull requests targeting the master branch, appropriate pull request title, and labels are met. It facilitates version control and release management within your CI/CD workflows.
See our next example for how to use the tag and release created by this job to publish a NuGet package.